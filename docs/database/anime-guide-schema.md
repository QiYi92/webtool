# Anime Guide æ•°æ®æ¨¡å‹è¯´æ˜

æœ¬é¡¹ç›®ä¸­çš„ **æ–°ç•ªå¯¼è§†** åŠŸèƒ½ç›®å‰ä»…æ¥å…¥ **Bangumiï¼ˆbgm.tvï¼‰** ä½œä¸ºæ•°æ®æºï¼Œ  
æ•°æ®ç”±åç«¯çˆ¬è™«å®šæœŸæŠ“å–å¹¶å†™å…¥ ADB Supabaseï¼ˆPostgreSQLï¼‰ï¼Œå‰ç«¯ä»…åšåªè¯»å±•ç¤ºã€‚

---

## è®¾è®¡åŸåˆ™

- **å•ä¸€æ•°æ®æº**ï¼šä»… Bangumiï¼Œä¸åšå¤šæ¥æºåˆå¹¶
- **å›¾ç‰‡ä¸è½åœ°**ï¼šä¸ä¿å­˜å›¾ç‰‡æ–‡ä»¶ï¼Œä»…å­˜å°é¢å›¾ç‰‡ URL
- **å‰ç«¯é«˜é¢‘è¯»ä¼˜åŒ–**ï¼šä¸ºæ—¥å† / æ˜ŸæœŸè§†å›¾å•ç‹¬å»ºè¡¨
- **è¯»å†™åˆ†ç¦»**ï¼š
  - å‰ç«¯ï¼ˆNext.jsï¼‰åªè¯»ï¼ˆé€šè¿‡åç«¯æ¥å£ï¼‰
  - åç«¯ï¼ˆFastAPI çˆ¬è™«ï¼‰é€šè¿‡ `DATABASE_URL` ç›´è¿å†™å…¥
- æ•°æ®ç»“æ„ä»¥â€œ**æ”¯æ’‘é¡µé¢**â€ä¸ºæ ¸å¿ƒï¼Œé¿å…è¿‡åº¦è®¾è®¡

---

## è¡¨ç»“æ„ä¸€è§ˆ

| è¡¨å | ä½œç”¨ |
|----|----|
| `anime` | ç•ªå‰§ä¸»è¡¨ï¼Œå­˜æ”¾ç•ªå‰§åŸºç¡€ä¿¡æ¯ä¸è¯¦æƒ…é¡µå­—æ®µ |
| `anime_episode` | ç•ªå‰§ç« èŠ‚ / é›†æ•°åˆ—è¡¨ |
| `anime_airing_calendar` | æ›´æ–°æ—¥å†è¡¨ï¼Œç”¨äºâ€œæŸå¤©æ›´æ–°äº†å“ªäº›ç•ªå‰§â€ |

---

## å„è¡¨å­—æ®µè¯¦è§£

### 1ï¸âƒ£ anime â€”â€” ç•ªå‰§ä¸»è¡¨

**ä¸€è¡Œ = ä¸€ä¸ª Bangumi ç•ªå‰§ï¼ˆsubjectï¼‰**

ç”¨äºï¼š
- æ–°ç•ªå¯¼è§†åˆ—è¡¨
- æ˜ŸæœŸç»´åº¦å±•ç¤º
- ç•ªå‰§è¯¦æƒ…é¡µåŸºç¡€ä¿¡æ¯

```text
anime

å­—æ®µå	ç±»å‹	è¯´æ˜
id	uuid	ä¸»é”®
bgm_subject_id	int	Bangumi subject idï¼ˆå”¯ä¸€ï¼‰
bgm_url	text	Bangumi è¯¦æƒ…é¡µ URL
title	text	åŸåï¼ˆæ—¥æ–‡ï¼‰
title_zh	text	ä¸­æ–‡åï¼ˆå¯ä¸ºç©ºï¼‰
summary	text	ç®€ä»‹ï¼ˆå¯ä¸ºç©ºï¼‰
start_date	date	æ”¾é€å¼€å§‹æ—¥æœŸï¼ˆå¯ä¸ºç©ºï¼‰
weekday	smallint	æ”¾é€æ˜ŸæœŸï¼ˆ0=å‘¨æ—¥ â€¦ 6=å‘¨å…­ï¼Œå¯ä¸ºç©ºï¼‰
total_episodes	int	æ€»è¯æ•°ï¼ˆå¯ä¸ºç©ºï¼‰
rating	numeric	Bangumi è¯„åˆ†ï¼ˆ10 åˆ†åˆ¶ï¼Œå¯ä¸ºç©ºï¼‰
rating_count	int	è¯„åˆ†äººæ•°ï¼ˆå¯ä¸ºç©ºï¼‰
cover_image_url	text	å°é¢å›¾ç‰‡ URLï¼ˆä¸å­˜æœ¬åœ°ï¼‰
status	text	airing / finished / upcomingï¼ˆå¯ä¸ºç©ºï¼‰
season	text	æ”¾é€å­£åº¦ï¼ˆå¦‚ 2026-winterï¼Œå¯ä¸ºç©ºï¼‰
last_crawled_at	timestamptz	ä¸Šæ¬¡çˆ¬å–æ—¶é—´ï¼ˆå¯ä¸ºç©ºï¼‰
crawl_version	int	çˆ¬è™«ç‰ˆæœ¬å·ï¼ˆå¯ä¸ºç©ºï¼‰
created_at	timestamptz	åˆ›å»ºæ—¶é—´
updated_at	timestamptz	æ›´æ–°æ—¶é—´
```

è¯´æ˜ï¼š
- `bgm_subject_id` ç”¨äº upsert å»é‡
- `weekday` æ˜¯å‰ç«¯â€œå‘¨ä¸€~å‘¨æ—¥æŒ‰é’®â€çš„æ ¸å¿ƒå­—æ®µ
- å›¾ç‰‡ä»…ä½¿ç”¨ Bangumi æä¾›çš„ URLï¼Œä¸è¿›è¡Œæœ¬åœ°å­˜å‚¨
- è¯„åˆ†ä¿æŒ Bangumi åŸå§‹ 10 åˆ†åˆ¶ï¼Œå‰ç«¯å¯è‡ªè¡Œæ¢ç®—ä¸º 5 åˆ†åˆ¶æ˜¾ç¤º

---

### 2ï¸âƒ£ anime_episode â€”â€” ç« èŠ‚ / é›†æ•°è¡¨

ä¸€è¡Œ = ä¸€é›†

ç”¨äºï¼š
- ç•ªå‰§è¯¦æƒ…é¡µã€Œç« èŠ‚åˆ—è¡¨ã€
- ç²¾ç¡®åˆ°é›†çš„æ”¾é€æ—¥æœŸï¼ˆå¦‚æ¥æºæä¾›ï¼‰

```text
anime_episode

å­—æ®µå	ç±»å‹	è¯´æ˜
id	uuid	ä¸»é”®
anime_id	uuid	å…³è” anime.id
episode_no	int	ç¬¬å‡ è¯
title	text	é›†æ ‡é¢˜ï¼ˆå¯ä¸ºç©ºï¼‰
air_date	date	æ’­å‡ºæ—¥æœŸï¼ˆå¯ä¸ºç©ºï¼‰
created_at	timestamptz	åˆ›å»ºæ—¶é—´
updated_at	timestamptz	æ›´æ–°æ—¶é—´
```

çº¦æŸï¼š
- (`anime_id`, `episode_no`) å”¯ä¸€
- anime åˆ é™¤æ—¶ç« èŠ‚è‡ªåŠ¨çº§è”åˆ é™¤

---

### 3ï¸âƒ£ anime_airing_calendar â€”â€” æ›´æ–°æ—¥å†è¡¨

ä¸€è¡Œ = æŸç•ªå‰§åœ¨æŸä¸€å¤©â€œæœ‰æ›´æ–°â€

ç”¨äºï¼š
- æ—¥å† hover æŸå¤© â†’ æ˜¾ç¤ºå½“å¤©æ›´æ–°ç•ªå‰§
- å·¦ä¾§â€œå½“å¤©æ›´æ–°åˆ—è¡¨â€

```text
anime_airing_calendar

å­—æ®µå	ç±»å‹	è¯´æ˜
id	uuid	ä¸»é”®
anime_id	uuid	å…³è” anime.id
air_date	date	æ›´æ–°æ—¥æœŸ
weekday	smallint	æ˜ŸæœŸï¼ˆ0=å‘¨æ—¥ â€¦ 6=å‘¨å…­ï¼‰
episode_no	int	å½“å¤©æ›´æ–°ç¬¬å‡ è¯ï¼ˆå¯ä¸ºç©ºï¼‰
created_at	timestamptz	åˆ›å»ºæ—¶é—´
```

è¯´æ˜ï¼š
- å•ç‹¬å»ºè¡¨æ˜¯ä¸ºäº†é¿å…å‰ç«¯å¤æ‚è®¡ç®—
- æ—¥å†/å½“å¤©æ›´æ–°æŸ¥è¯¢æ€§èƒ½ç¨³å®š
- (`anime_id`, `air_date`) å”¯ä¸€ï¼Œé¿å…é‡å¤å†™å…¥

---

## å…¸å‹æŸ¥è¯¢ç¤ºä¾‹ï¼ˆé€»è¾‘å±‚ï¼‰

ğŸ“… æŸå¤©æ›´æ–°ç•ªå‰§ï¼ˆæ–°ç•ªå¯¼è§†æ—¥å†ï¼‰

```sql
select a.*
from anime_airing_calendar c
join anime a on a.id = c.anime_id
where c.air_date = '2026-01-06'
order by a.rating desc nulls last;
```

ğŸ“† æ˜ŸæœŸç»´åº¦ç•ªå‰§åˆ—è¡¨

```sql
select *
from anime
where weekday = 2
order by rating desc nulls last;
```

ğŸ“˜ ç•ªå‰§è¯¦æƒ…é¡µ
- ä¸»ä¿¡æ¯ï¼šanime
- ç« èŠ‚åˆ—è¡¨ï¼šanime_episode
